function GoogleCalendarWebUIFramework(g){function m(a){d.calendarId=a;a=h.fetchEvents();d.eventCount=a.length;$.each(a,function(a,b){n(b)})}function f(a){a?($(b.loading).show(),$(b.auth).hide(),$(b.insert).hide(),$(b.separator).hide(),$(b.revoke).hide()):($(b.loading).hide(),k?($(b.insert).show(),$(b.separator).show(),$(b.revoke).show(),$(b.auth).hide()):($(b.insert).hide(),$(b.separator).hide(),$(b.revoke).hide(),$(b.auth).show()))}function p(){d.concurrentRequest--;d.eventCount--;0>=d.eventCount&&
(f(!1),alert("Schedules updated"))}function n(a){4<=d.concurrentRequest?setTimeout(function(){n(a)},500):(d.concurrentRequest++,e.client.calendar.events.list({calendarId:d.calendarId,timeMin:a.start.dateTime,timeMax:a.end.dateTime}).then(function(b){b.result.items.length?(console.log("Event '"+a.summary+"' has conflicting event at '"+a.start.dateTime+"'"),p()):(a.calendarId=d.calendarId,e.client.calendar.events.insert(a).then(function(a){console.log(a.result);p()},c.APIError))},c.APIError))}function q(a,
b){var c=setInterval(function(){a()&&(b(),clearInterval(c))},500)}function r(){q(function(){return window.gapi&&window.gapi.auth},function(){e=window.gapi;t(r)})}function u(){q(h.uiLoadChecker,function(){var a=h.uiWrapper();$(a).append(b.insert);$(a).append(b.auth);$(a).append(b.separator);$(a).append(b.revoke);$(a).append(b.loading);f(!0);t(u)})}function t(a){v++;a=a.toString();a=a.substr(9);a=a.substr(0,a.indexOf("("));console.log("Bootstrap sequence called from '"+a+"'");v>=w.length&&(console.log("Bootstrap sequence completed. Initializing API..."),
c.ClientLoad())}function x(a,b){l=a;y=b;$.each(w,function(a,b){b()})}var l,y,h=g||{},c={},d={eventCount:0,concurrentRequest:0,calendarName:h.calendarName},b=h.uiElements,k,e;c.ClientLoad=function(){e.client.setApiKey(y);e.client.load("calendar","v3").then(function(){window.setTimeout(c.AuthCheck,1)},c.APIError)};c.AuthCheck=function(){f(!0);e.auth.authorize({client_id:l,scope:"https://www.googleapis.com/auth/calendar",immediate:!0},c.AuthResult)};c.AuthRequest=function(){f(!0);e.auth.authorize({client_id:l,
scope:"https://www.googleapis.com/auth/calendar",immediate:!1},c.AuthResult)};c.AuthResult=function(a){a&&!a.error&&(k=a);f(!1)};c.RevokeRequest=function(){k.access_token&&(f(!0),$.ajax({url:"https://accounts.google.com/o/oauth2/revoke?token="+encodeURIComponent(k.access_token),complete:function(){k=null;f(!1)},xhrFields:{withCredentials:!0}}))};c.InsertRequest=function(){f(!0);e.client.calendar.calendarList.list().then(function(a){var b;$.each(a.result.items,function(a,c){if(c.summary==d.calendarName)return b=
c.id,!1});b?m(b):e.client.calendar.calendars.insert({summary:d.calendarName}).then(function(a){m(a.result.id)},c.APIError)},c.APIError)};c.APIError=function(a){console.log(a)};$(b.revoke).click(c.RevokeRequest);$(b.auth).click(c.AuthRequest);$(b.insert).click(c.InsertRequest);var v=0,w=[u,r];h.init=function(){if(g.clientId&&g.apiKey)x(g.clientId,g.apiKey);else if(g.credentialsUrl)$.get(g.credentialsUrl,function(a){x(a.clientId,a.apiKey)});else throw"Credentials (client ID & API key) not fully provided";
};return h};
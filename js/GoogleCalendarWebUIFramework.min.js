function GoogleCalendarWebUIFramework(f){var k,l,m;function p(a){k=a;a=g.fetchEvents();l=a.length;$.each(a,function(a,b){A(b)})}function e(a){a?($(b.loading).show(),$(b.auth).hide(),$(b.insert).hide(),$(b.separator).hide(),$(b.revoke).hide()):($(b.loading).hide(),h?($(b.insert).show(),$(b.separator).show(),$(b.revoke).show(),$(b.auth).hide()):($(b.insert).hide(),$(b.separator).hide(),$(b.revoke).hide(),$(b.auth).show()))}function q(){l--;0==l&&(e(!1),alert("Schedules updated"))}function A(a){d.client.calendar.events.list({calendarId:k,
timeMin:a.start.dateTime,timeMax:a.end.dateTime}).then(function(b){b.result.items.length?(console.log("Event '"+a.summary+"'' has conflicting event at '"+a.start.dateTime+"'"),q()):(a.calendarId=k,d.client.calendar.events.insert(a).then(function(a){console.log(a.result);q()},c.APIError))},c.APIError)}function r(a,b){var c=setInterval(function(){a()&&(b(),clearInterval(c))},500)}function t(){r(function(){return window.gapi&&window.gapi.auth},function(){d=window.gapi;u(t)})}function v(){r(g.uiLoadChecker,
function(){var a=g.uiWrapper();$(a).append(b.insert);$(a).append(b.auth);$(a).append(b.separator);$(a).append(b.revoke);$(a).append(b.loading);e(!0);u(v)})}function u(a){w++;a=a.toString();a=a.substr(9);a=a.substr(0,a.indexOf("("));console.log("Bootstrap sequence called from '"+a+"'");w>=x.length&&(console.log("Bootstrap sequence completed. Initializing API..."),c.ClientLoad())}function y(a,b){n=a;z=b;$.each(x,function(a,b){b()})}var n,z,g=f||{},c={};l=0;m=g.calendarName;k=void 0;var b=g.uiElements,
h,d;c.ClientLoad=function(){d.client.setApiKey(z);d.client.load("calendar","v3").then(function(){window.setTimeout(c.AuthCheck,1)},c.APIError)};c.AuthCheck=function(){e(!0);d.auth.authorize({client_id:n,scope:"https://www.googleapis.com/auth/calendar",immediate:!0},c.AuthResult)};c.AuthRequest=function(){e(!0);d.auth.authorize({client_id:n,scope:"https://www.googleapis.com/auth/calendar",immediate:!1},c.AuthResult)};c.AuthResult=function(a){a&&!a.error&&(h=a);e(!1)};c.RevokeRequest=function(){h.access_token&&
(e(!0),$.ajax({url:"https://accounts.google.com/o/oauth2/revoke?token="+encodeURIComponent(h.access_token),complete:function(){h=null;e(!1)},xhrFields:{withCredentials:!0}}))};c.InsertRequest=function(){e(!0);d.client.calendar.calendarList.list().then(function(a){var b;$.each(a.result.items,function(a,c){if(c.summary==m)return b=c.id,!1});b?p(b):d.client.calendar.calendars.insert({summary:m}).then(function(a){p(a.result.id)},c.APIError)},c.APIError)};c.APIError=function(a){console.log(a);alert("There's an error. Check the console for more information.")};
$(b.revoke).click(c.RevokeRequest);$(b.auth).click(c.AuthRequest);$(b.insert).click(c.InsertRequest);var w=0,x=[v,t];g.init=function(){if(f.clientId&&f.apiKey)y(f.clientId,f.apiKey);else if(f.credentialsUrl)$.get(f.credentialsUrl,function(a){y(a.clientId,a.apiKey)});else throw"Credentials (client ID & API key) not fully provided";};return g};
